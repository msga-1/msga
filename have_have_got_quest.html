<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Guardian of Grammar: Have (got) Quest</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-color: #05070a; --glass-bg: rgba(10, 15, 25, 0.98);
            --wood: #8B4513; --fire: #e74c3c; --earth: #2ecc71; --metal: #bdc3c7; --water: #3498db;
            --curr-color: var(--wood);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Inter', sans-serif; background: radial-gradient(circle at center, #1a1c2c 0%, #05070a 100%); 
            color: #f0f0f0; display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; padding: 15px; overflow: hidden;
        }
        .game-container { 
            width: 100%; max-width: 650px; min-height: 80vh; background: var(--glass-bg); padding: 30px; 
            border-radius: 35px; border: 4px solid var(--curr-color); display: flex; flex-direction: column; 
            text-align: center; box-shadow: 0 0 60px rgba(0,0,0,0.9); transition: border-color 0.8s; z-index: 10;
        }
        .header-section { min-height: 80px; }
        .element-bar { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .orb { width: 18px; height: 18px; border-radius: 50%; opacity: 0.1; border: 2px solid #fff; transition: 0.8s; }
        .orb.filled { opacity: 1; background: currentColor; box-shadow: 0 0 15px currentColor; }
        .hp-bar { font-size: 1.5rem; margin-bottom: 5px; color: #e74c3c; min-height: 30px; }
        .shard-section { height: 120px; display: flex; justify-content: center; align-items: center; }
        .shard-circle { position: relative; width: 100px; height: 100px; }
        .shard { 
            position: absolute; width: 18px; height: 32px; background: rgba(255,255,255,0.05); 
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%); transition: all 0.4s ease; 
            left: 50%; top: 50%; margin-left: -9px; margin-top: -16px; 
        }
        .shard.active { background: var(--curr-color); box-shadow: 0 0 20px var(--curr-color); opacity: 1; }
        .instruction-banner { 
            font-family: 'Oswald'; font-size: 1rem; color: var(--curr-color); 
            text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; 
            border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; 
        }
        .q-text { font-size: 1.4rem; font-weight: bold; margin: 15px 0; color: #fff; min-height: 50px; }
        .btn-action { 
            background: var(--curr-color); color: #fff; padding: 18px; border-radius: 12px; 
            font-size: 1.2rem; font-family: 'Oswald'; border: none; cursor: pointer; 
            width: 100%; transition: 0.2s; touch-action: manipulation;
        }
        input[type="text"] { 
            width: 100%; padding: 18px; background: rgba(0,0,0,0.5); border: 2px solid var(--curr-color); 
            color: white; border-radius: 12px; text-align: center; font-size: 1.3rem; outline: none; margin-bottom: 10px;
        }
        .feedback-box { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin: 20px 0; }
        .word-tag { padding: 10px 18px; border-radius: 12px; border: 2px solid transparent; font-size: 1.2rem; font-weight: bold; }
        .word-tag.correct { background: rgba(46, 204, 113, 0.2); color: #2ecc71; border-color: #2ecc71; }
        .word-tag.wrong { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border-color: #e74c3c; }
        .correction { display: block; font-size: 0.8rem; color: #fff; margin-top: 5px; font-weight: normal; background: rgba(0,0,0,0.4); padding: 2px 5px; border-radius: 4px; }
        
        .story-text { line-height: 1.6; margin-bottom: 20px; font-size: 1.1rem; }
        .big-win { font-family: 'Oswald'; font-size: 4.5rem; font-weight: 700; color: var(--curr-color); line-height: 1.1; margin-bottom: 20px; text-transform: uppercase; }
        .giant-element { font-size: 8rem; margin-top: 20px; display: block; filter: drop-shadow(0 0 20px var(--curr-color)); animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .footer-text { font-size: 0.8rem; opacity: 0.4; margin-top: auto; padding-top: 20px; font-family: 'Inter', sans-serif; letter-spacing: 1px; }
        .final-img { width: 100%; max-height: 200px; object-fit: cover; border-radius: 20px; margin-bottom: 20px; border: 2px solid gold; }
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

<div class="game-container" id="main-container">
    <div class="header-section">
        <div id="element-bar" class="element-bar" style="display:none;">
            <div id="st-1" class="orb" style="color:var(--wood)"></div>
            <div id="st-2" class="orb" style="color:var(--fire)"></div>
            <div id="st-3" class="orb" style="color:var(--earth)"></div>
            <div id="st-4" class="orb" style="color:var(--metal)"></div>
            <div id="st-5" class="orb" style="color:var(--water)"></div>
        </div>
        <div id="hp-display" class="hp-bar"></div>
        <h2 id="lvl-title">LOADING...</h2>
    </div>
    <div id="shard-viz" class="shard-section" style="display:none;"><div id="shard-circle" class="shard-circle"></div></div>
    <div class="interaction-section" id="game-content"></div>
    <div id="feedback-area"></div>
    <div class="footer-text">¬© Mister Seb's Grammar Apps</div>
</div>

<script>
    const DB = {
        1: [
            {q:"I ___ got a pen.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ you have a car?", o:["Have","Has","Do","Does"], a:"Do", instr:"Choose the correct word", type:"mc"},
            {q:"She ___ a car.", o:["have","has","do","does"], a:"has", instr:"Choose the correct word", type:"mc"},
            {q:"___ he got a cat?", o:["Have","Has","Do","Does"], a:"Has", instr:"Choose the correct word", type:"mc"},
            {q:"Do they ___ a garden?", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"Does he ___ a toy?", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"We ___ got books.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ she got a hat?", o:["Have","Has","Do","Does"], a:"Has", instr:"Choose the correct word", type:"mc"},
            {q:"They ___ a boat.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ it got a name?", o:["Have","Has","Do","Does"], a:"Has", instr:"Choose the correct word", type:"mc"},
            {q:"___ you have a pen?", o:["Have","Has","Do","Does"], a:"Do", instr:"Choose the correct word", type:"mc"},
            {q:"She ___ got a bag.", o:["have","has","do","does"], a:"has", instr:"Choose the correct word", type:"mc"},
            {q:"___ they have lunch?", o:["Have","Has","Do","Does"], a:"Do", instr:"Choose the correct word", type:"mc"},
            {q:"We ___ a house.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ it have wings?", o:["Have","Has","Do","Does"], a:"Does", instr:"Choose the correct word", type:"mc"},
            {q:"You ___ got a key.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ he have a coat?", o:["Have","Has","Do","Does"], a:"Does", instr:"Choose the correct word", type:"mc"},
            {q:"They ___ got water.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ she have a map?", o:["Have","Has","Do","Does"], a:"Does", instr:"Choose the correct word", type:"mc"},
            {q:"I ___ got a dog.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ the dog got a bone?", o:["Have","Has","Do","Does"], a:"Has", instr:"Choose the correct word", type:"mc"},
            {q:"Do you ___ a sister?", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"Does Sarah ___ a pen?", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"We ___ a big TV.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ he got any brothers?", o:["Have","Has","Do","Does"], a:"Has", instr:"Choose the correct word", type:"mc"},
            {q:"___ they have a pool?", o:["Have","Has","Do","Does"], a:"Do", instr:"Choose the correct word", type:"mc"},
            {q:"It ___ got four legs.", o:["have","has","do","does"], a:"has", instr:"Choose the correct word", type:"mc"},
            {q:"___ you have a hobby?", o:["Have","Has","Do","Does"], a:"Do", instr:"Choose the correct word", type:"mc"},
            {q:"He ___ a red shirt.", o:["have","has","do","does"], a:"has", instr:"Choose the correct word", type:"mc"},
            {q:"___ she got a secret?", o:["Have","Has","Do","Does"], a:"Has", instr:"Choose the correct word", type:"mc"},
            {q:"We ___ got a new ball.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ you got the time?", o:["Have","Has","Do","Does"], a:"Have", instr:"Choose the correct word", type:"mc"},
            {q:"Do we ___ a test today?", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"Does he ___ a cold?", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"They ___ got a goal.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ it have a battery?", o:["Have","Has","Do","Does"], a:"Does", instr:"Choose the correct word", type:"mc"},
            {q:"I ___ a laptop.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ she got long hair?", o:["Have","Has","Do","Does"], a:"Has", instr:"Choose the correct word", type:"mc"},
            {q:"___ you have a question?", o:["Have","Has","Do","Does"], a:"Do", instr:"Choose the correct word", type:"mc"},
            {q:"Tom ___ got a bike.", o:["have","has","do","does"], a:"has", instr:"Choose the correct word", type:"mc"},
            {q:"___ they have a pet?", o:["Have","Has","Do","Does"], a:"Do", instr:"Choose the correct word", type:"mc"},
            {q:"___ the cat got a bell?", o:["Have","Has","Do","Does"], a:"Has", instr:"Choose the correct word", type:"mc"},
            {q:"We ___ a problem.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ he have a sister?", o:["Have","Has","Do","Does"], a:"Does", instr:"Choose the correct word", type:"mc"},
            {q:"She ___ got a friend.", o:["have","has","do","does"], a:"has", instr:"Choose the correct word", type:"mc"},
            {q:"___ you got a pencil?", o:["Have","Has","Do","Does"], a:"Have", instr:"Choose the correct word", type:"mc"},
            {q:"Does it ___ a motor?", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"They ___ a house.", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"},
            {q:"___ he got a map?", o:["Have","Has","Do","Does"], a:"Has", instr:"Choose the correct word", type:"mc"},
            {q:"Do you ___ a snack?", o:["have","has","do","does"], a:"have", instr:"Choose the correct word", type:"mc"}
        ],
        2: [
            {q:"I have got a pen.", a:"I haven't got a pen.", instr:"Make the sentence negative", type:"open"},
            {q:"She has got a bike.", a:"She hasn't got a bike.", instr:"Make the sentence negative", type:"open"},
            {q:"We have a car.", a:"We don't have a car.", instr:"Make the sentence negative", type:"open"},
            {q:"He has a dog.", a:"He doesn't have a dog.", instr:"Make the sentence negative", type:"open"},
            {q:"They have got a secret.", a:"They haven't got a secret.", instr:"Make the sentence negative", type:"open"},
            {q:"You have a house.", a:"You don't have a house.", instr:"Make the sentence negative", type:"open"},
            {q:"It has got a tail.", a:"It hasn't got a tail.", instr:"Make the sentence negative", type:"open"},
            {q:"My dad has a job.", a:"My dad doesn't have a job.", instr:"Make the sentence negative", type:"open"},
            {q:"I have a book.", a:"I don't have a book.", instr:"Make the sentence negative", type:"open"},
            {q:"She has got a bag.", a:"She hasn't got a bag.", instr:"Make the sentence negative", type:"open"},
            {q:"They have a test.", a:"They don't have a test.", instr:"Make the sentence negative", type:"open"},
            {q:"He has got a phone.", a:"He hasn't got a phone.", instr:"Make the sentence negative", type:"open"},
            {q:"We have got lunch.", a:"We haven't got lunch.", instr:"Make the sentence negative", type:"open"},
            {q:"It has a wheel.", a:"It doesn't have a wheel.", instr:"Make the sentence negative", type:"open"},
            {q:"You have got time.", a:"You haven't got time.", instr:"Make the sentence negative", type:"open"},
            {q:"Tom has a cat.", a:"Tom doesn't have a cat.", instr:"Make the sentence negative", type:"open"},
            {q:"I have got a map.", a:"I haven't got a map.", instr:"Make the sentence negative", type:"open"},
            {q:"She has a brother.", a:"She doesn't have a brother.", instr:"Make the sentence negative", type:"open"},
            {q:"They have got shoes.", a:"They haven't got shoes.", instr:"Make the sentence negative", type:"open"},
            {q:"We have a goal.", a:"We don't have a goal.", instr:"Make the sentence negative", type:"open"},
            {q:"He has a key.", a:"He doesn't have a key.", instr:"Make the sentence negative", type:"open"},
            {q:"It has got wings.", a:"It hasn't got wings.", instr:"Make the sentence negative", type:"open"},
            {q:"You have a pencil.", a:"You don't have a pencil.", instr:"Make the sentence negative", type:"open"},
            {q:"The cat has a ball.", a:"The cat doesn't have a ball.", instr:"Make the sentence negative", type:"open"},
            {q:"I have got a sister.", a:"I haven't got a sister.", instr:"Make the sentence negative", type:"open"},
            {q:"She has got a doll.", a:"She hasn't got a doll.", instr:"Make the sentence negative", type:"open"},
            {q:"We have got a TV.", a:"We haven't got a TV.", instr:"Make the sentence negative", type:"open"},
            {q:"He has got a bike.", a:"He hasn't got a bike.", instr:"Make the sentence negative", type:"open"},
            {q:"They have a boat.", a:"They don't have a boat.", instr:"Make the sentence negative", type:"open"},
            {q:"It has a name.", a:"It doesn't have a name.", instr:"Make the sentence negative", type:"open"},
            {q:"You have got a box.", a:"You haven't got a box.", instr:"Make the sentence negative", type:"open"},
            {q:"My friend has a toy.", a:"My friend doesn't have a toy.", instr:"Make the sentence negative", type:"open"},
            {q:"I have a snack.", a:"I don't have a snack.", instr:"Make the sentence negative", type:"open"},
            {q:"She has got a cold.", a:"She hasn't got a cold.", instr:"Make the sentence negative", type:"open"},
            {q:"We have a pool.", a:"We don't have a pool.", instr:"Make the sentence negative", type:"open"},
            {q:"He has a coat.", a:"He doesn't have a coat.", instr:"Make the sentence negative", type:"open"},
            {q:"They have got a goal.", a:"They haven't got a goal.", instr:"Make the sentence negative", type:"open"},
            {q:"It has a battery.", a:"It doesn't have a battery.", instr:"Make the sentence negative", type:"open"},
            {q:"You have a key.", a:"You don't have a key.", instr:"Make the sentence negative", type:"open"},
            {q:"Tom has got a car.", a:"Tom hasn't got a car.", instr:"Make the sentence negative", type:"open"},
            {q:"I have got a hobby.", a:"I haven't got a hobby.", instr:"Make the sentence negative", type:"open"},
            {q:"She has a question.", a:"She doesn't have a question.", instr:"Make the sentence negative", type:"open"},
            {q:"We have got books.", a:"We haven't got books.", instr:"Make the sentence negative", type:"open"},
            {q:"He has got a hat.", a:"He hasn't got a hat.", instr:"Make the sentence negative", type:"open"},
            {q:"They have got water.", a:"They haven't got water.", instr:"Make the sentence negative", type:"open"},
            {q:"It has got a bell.", a:"It hasn't got a bell.", instr:"Make the sentence negative", type:"open"},
            {q:"You have got a pen.", a:"You haven't got a pen.", instr:"Make the sentence negative", type:"open"},
            {q:"Sarah has a bag.", a:"Sarah doesn't have a bag.", instr:"Make the sentence negative", type:"open"},
            {q:"I have a problem.", a:"I don't have a problem.", instr:"Make the sentence negative", type:"open"},
            {q:"She has a cat.", a:"She doesn't have a cat.", instr:"Make the sentence negative", type:"open"}
        ],
        3: [
            {q:"You have got a pen.", a:"Have you got a pen?", instr:"Make a question", type:"open"},
            {q:"She has got a bike.", a:"Has she got a bike?", instr:"Make a question", type:"open"},
            {q:"They have a car.", a:"Do they have a car?", instr:"Make a question", type:"open"},
            {q:"He has a dog.", a:"Does he have a dog?", instr:"Make a question", type:"open"},
            {q:"We have got time.", a:"Have we got time?", instr:"Make a question", type:"open"},
            {q:"You have a key.", a:"Do you have a key?", instr:"Make a question", type:"open"},
            {q:"It has got a tail.", a:"Has it got a tail?", instr:"Make a question", type:"open"},
            {q:"Tom has a bike.", a:"Does Tom have a bike?", instr:"Make a question", type:"open"},
            {q:"They have got books.", a:"Have they got books?", instr:"Make a question", type:"open"},
            {q:"I have a problem.", a:"Do I have a problem?", instr:"Make a question", type:"open"},
            {q:"She has a cat.", a:"Does she have a cat?", instr:"Make a question", type:"open"},
            {q:"We have a map.", a:"Do we have a map?", instr:"Make a question", type:"open"},
            {q:"He has got a phone.", a:"Has he got a phone?", instr:"Make a question", type:"open"},
            {q:"It has a motor.", a:"Does it have a motor?", instr:"Make a question", type:"open"},
            {q:"You have got a gift.", a:"Have you got a gift?", instr:"Make a question", type:"open"},
            {q:"They have got water.", a:"Have they got water?", instr:"Make a question", type:"open"},
            {q:"She has got a sister.", a:"Has she got a sister?", instr:"Make a question", type:"open"},
            {q:"We have got lunch.", a:"Have we got lunch?", instr:"Make a question", type:"open"},
            {q:"He has a hat.", a:"Does he have a hat?", instr:"Make a question", type:"open"},
            {q:"They have a house.", a:"Do they have a house?", instr:"Make a question", type:"open"},
            {q:"You have a boat.", a:"Do you have a boat?", instr:"Make a question", type:"open"},
            {q:"It has got a name.", a:"Has it got a name?", instr:"Make a question", type:"open"},
            {q:"Sarah has a secret.", a:"Does Sarah have a secret?", instr:"Make a question", type:"open"},
            {q:"I have got a doll.", a:"Have I got a doll?", instr:"Make a question", type:"open"},
            {q:"They have got shoes.", a:"Have they got shoes?", instr:"Make a question", type:"open"},
            {q:"We have a test.", a:"Do we have a test?", instr:"Make a question", type:"open"},
            {q:"He has got a cold.", a:"Has he got a cold?", instr:"Make a question", type:"open"},
            {q:"You have got a box.", a:"Have you got a box?", instr:"Make a question", type:"open"},
            {q:"It has got wings.", a:"Has it got wings?", instr:"Make a question", type:"open"},
            {q:"Tom has got a car.", a:"Has Tom got a car?", instr:"Make a question", type:"open"},
            {q:"She has a brother.", a:"Does she have a brother?", instr:"Make a question", type:"open"},
            {q:"They have got a goal.", a:"Have they got a goal?", instr:"Make a question", type:"open"},
            {q:"I have got a bike.", a:"Have I got a bike?", instr:"Make a question", type:"open"},
            {q:"You have a pencil.", a:"Do you have a pencil?", instr:"Make a question", type:"open"},
            {q:"It has a battery.", a:"Does it have a battery?", instr:"Make a question", type:"open"},
            {q:"He has a coat.", a:"Does he have a coat?", instr:"Make a question", type:"open"},
            {q:"We have got a TV.", a:"Have we got a TV?", instr:"Make a question", type:"open"},
            {q:"They have a pool.", a:"Do they have a pool?", instr:"Make a question", type:"open"},
            {q:"She has got a bag.", a:"Has she got a bag?", instr:"Make a question", type:"open"},
            {q:"Tom has a dog.", a:"Does Tom have a dog?", instr:"Make a question", type:"open"},
            {q:"I have a snack.", a:"Do I have a snack?", instr:"Make a question", type:"open"},
            {q:"We have got a map.", a:"Have we got a map?", instr:"Make a question", type:"open"},
            {q:"You have got a key.", a:"Have you got a key?", instr:"Make a question", type:"open"},
            {q:"He has got a ball.", a:"Has he got a ball?", instr:"Make a question", type:"open"},
            {q:"They have got time.", a:"Have they got time?", instr:"Make a question", type:"open"},
            {q:"She has a hobby.", a:"Does she have a hobby?", instr:"Make a question", type:"open"},
            {q:"It has a bell.", a:"Does it have a bell?", instr:"Make a question", type:"open"},
            {q:"You have got a pen.", a:"Have you got a pen?", instr:"Make a question", type:"open"},
            {q:"We have got a break.", a:"Have we got a break?", instr:"Make a question", type:"open"},
            {q:"They have a dream.", a:"Do they have a dream?", instr:"Make a question", type:"open"}
        ],
        4: [
            {q:"Does he have a dog?", a:"He has a dog.", instr:"Make the sentence positive", type:"open"},
            {q:"Has she got a pen?", a:"She has got a pen.", instr:"Make the sentence positive", type:"open"},
            {q:"Do they have a car?", a:"They have a car.", instr:"Make the sentence positive", type:"open"},
            {q:"Have you got a key?", a:"I have got a key.", instr:"Make the sentence positive", type:"open"},
            {q:"Does she have a cat?", a:"She has a cat.", instr:"Make the sentence positive", type:"open"},
            {q:"Has he got a bike?", a:"He has got a bike.", instr:"Make the sentence positive", type:"open"},
            {q:"Do we have a test?", a:"We have a test.", instr:"Make the sentence positive", type:"open"},
            {q:"Have they got a dog?", a:"They have got a dog.", instr:"Make the sentence positive", type:"open"},
            {q:"Does it have a name?", a:"It has a name.", instr:"Make the sentence positive", type:"open"},
            {q:"Have you got a phone?", a:"I have got a phone.", instr:"Make the sentence positive", type:"open"},
            {q:"Does Sarah have a bag?", a:"Sarah has a bag.", instr:"Make the sentence positive", type:"open"},
            {q:"Has Tom got a cold?", a:"Tom has got a cold.", instr:"Make the sentence positive", type:"open"},
            {q:"Do they have lunch?", a:"They have lunch.", instr:"Make the sentence positive", type:"open"},
            {q:"Have we got a map?", a:"We have got a map.", instr:"Make the sentence positive", type:"open"},
            {q:"Does he have a coat?", a:"He has a coat.", instr:"Make the sentence positive", type:"open"},
            {q:"Has it got a tail?", a:"It has got a tail.", instr:"Make the sentence positive", type:"open"},
            {q:"Do you have a hobby?", a:"I have a hobby.", instr:"Make the sentence positive", type:"open"},
            {q:"Have they got water?", a:"They have got water.", instr:"Make the sentence positive", type:"open"},
            {q:"Does she have a secret?", a:"She has a secret.", instr:"Make the sentence positive", type:"open"},
            {q:"Has he got a brother?", a:"He has got a brother.", instr:"Make the sentence positive", type:"open"},
            {q:"Do we have a break?", a:"We have a break.", instr:"Make the sentence positive", type:"open"},
            {q:"Have you got a pencil?", a:"I have got a pencil.", instr:"Make the sentence positive", type:"open"},
            {q:"Does it have a wheel?", a:"It has a wheel.", instr:"Make the sentence positive", type:"open"},
            {q:"Has Tom got a car?", a:"Tom has got a car.", instr:"Make the sentence positive", type:"open"},
            {q:"Do they have a pool?", a:"They have a pool.", instr:"Make the sentence positive", type:"open"},
            {q:"Have we got books?", a:"We have got books.", instr:"Make the sentence positive", type:"open"},
            {q:"Does he have a key?", a:"He has a key.", instr:"Make the sentence positive", type:"open"},
            {q:"Has she got a doll?", a:"She has got a doll.", instr:"Make the sentence positive", type:"open"},
            {q:"Do you have a sister?", a:"I have a sister.", instr:"Make the sentence positive", type:"open"},
            {q:"Have they got time?", a:"They have got time.", instr:"Make the sentence positive", type:"open"},
            {q:"Does it have a battery?", a:"It has a battery.", instr:"Make the sentence positive", type:"open"},
            {q:"Has he got a hat?", a:"He has got a hat.", instr:"Make the sentence positive", type:"open"},
            {q:"Do they have a boat?", a:"They have a boat.", instr:"Make the sentence positive", type:"open"},
            {q:"Have we got a goal?", a:"We have got a goal.", instr:"Make the sentence positive", type:"open"},
            {q:"Does she have a pencil?", a:"She has a pencil.", instr:"Make the sentence positive", type:"open"},
            {q:"Has Tom got a sister?", a:"Tom has got a sister.", instr:"Make the sentence positive", type:"open"},
            {q:"Do you have a snack?", a:"I have a snack.", instr:"Make the sentence positive", type:"open"},
            {q:"Have they got a ball?", a:"They have got a ball.", instr:"Make the sentence positive", type:"open"},
            {q:"Does it have wings?", a:"It has wings.", instr:"Make the sentence positive", type:"open"},
            {q:"Has he got a laptop?", a:"He has got a laptop.", instr:"Make the sentence positive", type:"open"},
            {q:"Do they have a house?", a:"They have a house.", instr:"Make the sentence positive", type:"open"},
            {q:"Have we got a TV?", a:"We have got a TV.", instr:"Make the sentence positive", type:"open"},
            {q:"Does she have a phone?", a:"She has a phone.", instr:"Make the sentence positive", type:"open"},
            {q:"Has it got a bell?", a:"It has got a bell.", instr:"Make the sentence positive", type:"open"},
            {q:"Do you have a dream?", a:"I have a dream.", instr:"Make the sentence positive", type:"open"},
            {q:"Have they got a box?", a:"They have got a box.", instr:"Make the sentence positive", type:"open"},
            {q:"Does he have a bike?", a:"He has a bike.", instr:"Make the sentence positive", type:"open"},
            {q:"Has Sarah got a cat?", a:"Sarah has got a cat.", instr:"Make the sentence positive", type:"open"},
            {q:"Do we have a question?", a:"We have a question.", instr:"Make the sentence positive", type:"open"},
            {q:"Have you got a pen?", a:"I have got a pen.", instr:"Make the sentence positive", type:"open"}
        ]
    };

    let lvl = localStorage.getItem('wu_lvl') === null ? 0 : parseInt(localStorage.getItem('wu_lvl'));
    let shards = parseInt(localStorage.getItem('wu_shards')) || 0;
    let hp = 5;
    let currentTask = null;

    const titles = {1:"Wood Realm üå≥", 2:"Fire Realm üî•", 3:"Earth Realm üåç", 4:"Metal Realm ‚öîÔ∏è", 5:"Water Realm üåä"};
    const symbols = {1:"üå≥", 2:"üî•", 3:"üåç", 4:"‚öîÔ∏è", 5:"üåä"};
    const colors = {1:"var(--wood)", 2:"var(--fire)", 3:"var(--earth)", 4:"var(--metal)", 5:"var(--water)"};

    function save() { localStorage.setItem('wu_lvl', lvl); localStorage.setItem('wu_shards', shards); }

    function init() {
        document.getElementById('feedback-area').innerHTML = "";
        document.getElementById('hp-display').style.display = (lvl === 5) ? 'block' : 'none';
        if (lvl === 0) {
            document.getElementById('shard-viz').style.display = 'none';
            document.getElementById('element-bar').style.display = 'none';
            document.getElementById('lvl-title').innerText = "Individual Quest";
            document.getElementById('game-content').innerHTML = `<div class="story-text">The world is in chaos.

Two grammar forces are fighting for control: Have and Have got. Their battle has twisted sentences and scattered glowing grammar shards across the Realms. Worst of all, they have mixed up how we ask questions and make negatives.

Now, nobody knows what is right anymore.

You have been chosen to restore order.

Travel through five magical Realms. In each Realm, complete challenges that test your knowledge of have and have got. Every correct answer returns a grammar shard to its place and brings clarity back to the world.

You will need focus, sharp thinking, and careful reading to win this battle.

But be careful‚Ä¶

In the Water Realm, you have only five lives.

Choose wisely. Collect the shards. Bring balance back to grammar.</div><button class="btn-action" onclick="lvl=1; save(); init();">Start Quest</button>`;
        } else if (lvl > 5) { showFinalWin(); } 
        else {
            document.getElementById('shard-viz').style.display = 'flex';
            document.getElementById('element-bar').style.display = 'flex';
            document.documentElement.style.setProperty('--curr-color', colors[lvl]);
            document.getElementById('lvl-title').innerText = titles[lvl];
            for(let i=1; i<=5; i++) document.getElementById(`st-${i}`).classList.toggle('filled', i < lvl);
            renderTask();
        }
    }

    function renderTask() {
        updateShards();
        if(lvl === 5) document.getElementById('hp-display').innerText = "‚ù§Ô∏è".repeat(hp);
        document.getElementById('feedback-area').innerHTML = "";
        let pool = (lvl === 5) ? [...DB[1], ...DB[2], ...DB[3], ...DB[4]] : DB[lvl];
        currentTask = pool[Math.floor(Math.random() * pool.length)];
        let html = `<div class="instruction-banner">${currentTask.instr}</div><div class="q-text">${currentTask.q}</div>`;
        if(currentTask.type === "mc") {
            html += `<div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">` + currentTask.o.map(opt => `<button class="btn-action" onclick="handleCheck('${opt}')">${opt}</button>`).join('') + `</div>`;
        } else {
            html += `<input type="text" id="ans" placeholder="..." autocomplete="off" spellcheck="false"><button class="btn-action" onclick="handleCheck(document.getElementById('ans').value)">Check Answer</button>`;
        }
        document.getElementById('game-content').innerHTML = html;
        if(document.getElementById('ans')) { document.getElementById('ans').focus(); document.getElementById('ans').onkeyup = (e) => { if(e.key === 'Enter') handleCheck(document.getElementById('ans').value); }; }
    }

    function isFlexibleMatch(input, target) {
        const clean = (s) => s.replace("n't", " not").replace(/\s+/g, ' ').replace(/[.?]/g, '').trim();
        return clean(input) === clean(target);
    }

    function handleCheck(val) {
        if(!val) return;
        let v = val.trim(), target = currentTask.a;
        
        // Strenge check op hoofdletters en interpunctie
        let isCorrect = (currentTask.type === "mc") 
            ? (v === target) 
            : (isFlexibleMatch(v, target) && v.charAt(0) === target.charAt(0) && v.slice(-1) === target.slice(-1));

        if(isCorrect) {
            shards++; save();
            let goal = (lvl === 5) ? 10 : 5;
            if(shards >= goal) showLevelWin();
            else { 
                document.getElementById('feedback-area').innerHTML = `<span style="color:var(--curr-color); font-size:1.2rem;">‚ú® SHARD COLLECTED (${shards}/${goal})</span>`; 
                setTimeout(renderTask, 800); 
            }
        } else {
            if (lvl === 5) { hp--; if (hp <= 0) { gameOver(); return; } } else { shards = 0; }
            showFailFeedback(v);
        }
    }

    function showFailFeedback(input) {
        const targetWords = currentTask.a.split(" "), inputWords = input.split(" ");
        let fb = `<div class="feedback-box">` + targetWords.map((t, i) => {
            const isW = t === inputWords[i];
            return `<div class="word-tag ${isW?'correct':'wrong'}">${inputWords[i]||"___"}${isW?'':`<span class="correction">${t}</span>`}</div>`;
        }).join('') + `</div><button class="btn-action" onclick="renderTask()">Try Again</button>`;
        document.getElementById('game-content').innerHTML = `<div class="q-text" style="color:var(--fire); font-size:1.6rem;">Check Grammar, Punctuation or Caps!</div>`;
        document.getElementById('feedback-area').innerHTML = fb;
    }

    function showLevelWin() {
        if(lvl === 5) { document.getElementById(`st-5`).classList.add('filled'); showFinalWin(); return; }
        document.getElementById('shard-viz').style.display = 'none';
        document.getElementById('game-content').innerHTML = `<div class="big-win">REALM RESTORED!</div><button class="btn-action" onclick="shards=0; lvl++; save(); init();">Next Stage</button><div class="giant-element">${symbols[lvl]}</div>`;
    }

    function gameOver() {
        lvl = 1; shards = 0; hp = 5; save();
        document.getElementById('game-content').innerHTML = `<h2 style="color:var(--fire)">QUEST FAILED</h2><button class="btn-action" onclick="init()">Restart From Beginning</button>`;
    }

    function showFinalWin() {
        document.getElementById('lvl-title').innerText = "QUEST COMPLETE";
        document.getElementById('shard-viz').style.display = 'none';
        document.getElementById('game-content').innerHTML = `<div class="big-win">üåü LIBRARY RESTORED! üåü</div><img src="https://images.unsplash.com/photo-1507842217343-583bb7270b66?ixlib=rb-1.2.1&auto=format&fit=crop&w=1000&q=80" class="final-img" alt="Library"><p>You have mastered Have and Have Got.</p><button class="btn-action" onclick="localStorage.clear(); location.reload();">Reset Progress</button>`;
        confetti({ particleCount: 200, spread: 90, origin: { y: 0.6 } });
    }

    function updateShards() {
        const container = document.getElementById('shard-circle'), goal = (lvl === 5) ? 10 : 5;
        if(container) container.innerHTML = Array.from({length: goal}, (_, i) => `<div class="shard ${i < shards ? 'active' : ''}" style="transform: rotate(${i*(360/goal)}deg) translateY(-40px);"></div>`).join('');
    }
    init();
</script>
</body>
</html>

