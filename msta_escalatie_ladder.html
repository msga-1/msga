<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escalatieladder Pro - Mister Seb</title>
    <style>
        :root {
            --bg-color: #121212;
            --tile-default: #2a2a2a;
            --color-1: #2ecc71; /* Groen */
            --color-2: #3498db; /* Blauw */
            --color-3: #f1c40f; /* Geel */
            --color-4: #e67e22; /* Oranje */
            --color-5: #e74c3c; /* Rood */
            --modal-bg: #222;
        }

        html, body {
            height: 100vh; margin: 0; padding: 0; overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Arial Black', sans-serif;
            display: flex; flex-direction: column;
        }

        header {
            height: 8vh; display: flex; justify-content: space-between; align-items: center;
            background: #000; border-bottom: 2px solid #333; padding: 0 20px;
        }

        .header-left, .header-right { display: flex; gap: 10px; align-items: center; }
        
        .lang-selector { display: flex; gap: 8px; margin-right: 15px; }
        .flag { cursor: pointer; font-size: 1.4rem; filter: grayscale(0.6); transition: 0.2s; }
        .flag.active { filter: grayscale(0); transform: scale(1.2); }

        select, button.icon-btn, .modal-btn {
            background: #333; color: white; border: 1px solid #555;
            padding: 8px 12px; cursor: pointer; border-radius: 6px; font-weight: bold;
        }

        h1 { color: white; margin: 0; font-size: clamp(0.9rem, 2vw, 1.3rem); text-transform: uppercase; flex-grow: 1; text-align: center; }

        /* VERBETERDE LEGENDA */
        .legend {
            height: 7vh; display: flex; justify-content: center; align-items: center;
            gap: 20px; background: #222; border-bottom: 1px solid #444;
            padding: 0 10px;
        }

        .legend-item { 
            display: flex; align-items: center; gap: 8px; 
            color: white; font-family: 'Arial', sans-serif; font-weight: 800;
            font-size: clamp(0.8rem, 1.5vh, 1.1rem);
            background: rgba(255,255,255,0.05); padding: 5px 12px; border-radius: 20px;
        }
        .dot { 
            width: 20px; height: 20px; border-radius: 50%; border: 2px solid #fff; 
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        .grid-container {
            flex-grow: 1; padding: 10px; display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            grid-auto-rows: 1fr; gap: 10px; box-sizing: border-box;
        }

        .student-tile {
            background: var(--tile-default); border: 2px solid #444; border-radius: 8px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; color: white; text-align: center; transition: transform 0.05s;
        }
        .student-tile:active { transform: scale(0.95); }

        .student-name { font-size: clamp(1.1rem, 3vh, 2.2rem); font-weight: 900; line-height: 1.1; }
        .consequence { font-size: clamp(0.6rem, 1.5vh, 0.9rem); margin-top: 5px; font-weight: bold; text-transform: uppercase; opacity: 0.9; }

        .status-1 { background-color: var(--color-1); color: #000; border-color: #fff; }
        .status-2 { background-color: var(--color-2); color: #fff; border-color: #fff; }
        .status-3 { background-color: var(--color-3); color: #000; border-color: #000; }
        .status-4 { background-color: var(--color-4); color: #fff; border-color: #fff; }
        .status-5 { background-color: var(--color-5); color: #fff; animation: pulse 1s infinite alternate; }

        @keyframes pulse { from { box-shadow: inset 0 0 10px #000; } to { box-shadow: inset 0 0 30px #fff; } }

        footer { 
            height: 6vh; display: flex; justify-content: space-between; align-items: center; 
            background: #000; padding: 0 20px; color: #666; font-family: sans-serif; font-size: 0.8rem;
        }
        .btn-reset { background: #222; color: #888; border: 1px solid #444; padding: 6px 15px; cursor: pointer; font-size: 0.75rem; border-radius: 4px;}
        .btn-reset:hover { color: white; background: #e74c3c; }

        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center;
        }
        .modal {
            background: var(--modal-bg); padding: 25px; border-radius: 12px;
            width: 90%; max-width: 500px; color: white; border: 1px solid #444;
        }
        .modal input, .modal textarea {
            width: 100%; background: #111; border: 1px solid #444; color: white;
            padding: 10px; margin-bottom: 10px; border-radius: 4px; box-sizing: border-box; font-family: sans-serif;
        }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }
        .btn-save { background: var(--color-1); color: black; border: none; }
        .config-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .config-dot { width: 24px; height: 24px; border-radius: 4px; flex-shrink: 0; }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <select id="classSelector" onchange="switchClass()"></select>
            <button class="icon-btn" onclick="openModal('classModal')" id="btn-new-class">Nieuwe Klas +</button>
        </div>
        <h1 id="main-title">Escalatieladder</h1>
        <div class="header-right">
            <div class="lang-selector">
                <span class="flag" onclick="setLanguage('nl')" id="flag-nl">üá≥üá±</span>
                <span class="flag" onclick="setLanguage('en')" id="flag-en">üá¨üáß</span>
                <span class="flag" onclick="setLanguage('fr')" id="flag-fr">üá´üá∑</span>
                <span class="flag" onclick="setLanguage('de')" id="flag-de">üá©üá™</span>
            </div>
            <button class="icon-btn" onclick="openModal('configModal')">‚öôÔ∏è</button>
            <button class="icon-btn" onclick="deleteCurrentClass()">üóëÔ∏è</button>
        </div>
    </header>

    <div id="legendDisplay" class="legend"></div>
    <div id="grid" class="grid-container"></div>

    <footer>
        <div style="flex:1">¬© Mister Seb's Teacher Apps</div>
        <button class="btn-reset" onclick="resetAll()" id="btn-reset">RESET LES</button>
        <div style="flex:1; text-align: right;">v2.1</div>
    </footer>

    <div id="classModal" class="modal-overlay">
        <div class="modal">
            <h2 id="modal-class-title">Nieuwe klas aanmaken</h2>
            <input type="text" id="newClassName" placeholder="Klasnaam">
            <p id="modal-class-help" style="font-size: 0.8rem; color: #888;">Namen plakken uit Excel...</p>
            <textarea id="newStudentList" style="height:150px"></textarea>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeModal('classModal')" id="btn-cancel-1">Annuleren</button>
                <button class="modal-btn btn-save" onclick="saveNewClass()" id="btn-save-1">Opslaan</button>
            </div>
        </div>
    </div>

    <div id="configModal" class="modal-overlay">
        <div class="modal">
            <h2 id="modal-config-title">Escalaties Instellen</h2>
            <p id="modal-config-help" style="font-size: 0.8rem; color: #888; margin-bottom: 10px;">Leeg veld = stap overslaan</p>
            <div id="configSteps"></div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeModal('configModal')" id="btn-cancel-2">Annuleren</button>
                <button class="modal-btn btn-save" onclick="saveConfig()" id="btn-save-2">Opslaan</button>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            nl: {
                title: "Escalatieladder", newClass: "Klas +", reset: "RESET LES",
                delConfirm: "Klas volledig verwijderen?", resetConfirm: "Klas resetten naar neutraal?",
                modalClass: "Nieuwe klas aanmaken", modalHelp: "Plak namen (√©√©n per regel):",
                cancel: "Annuleren", save: "Opslaan", config: "Instellingen",
                configHelp: "Leeg veld = stap overslaan", empty: "Maak een klas aan om te beginnen",
                defaultSteps: ["Waarschuwing", "Blijven zitten", "8 uur melden", "Uur terug", "UITSTUUR"]
            },
            en: {
                title: "Escalation Ladder", newClass: "Class +", reset: "RESET LESSON",
                delConfirm: "Delete this class permanently?", resetConfirm: "Reset all students to neutral?",
                modalClass: "Create New Class", modalHelp: "Paste names (one per line):",
                cancel: "Cancel", save: "Save", config: "Settings",
                configHelp: "Empty field = skip step", empty: "Create a class to start",
                defaultSteps: ["Warning", "Detention", "Report", "Step Back", "SENT OUT"]
            },
            fr: {
                title: "√âchelle de Sanction", newClass: "Classe +", reset: "R√âINITIALISER",
                delConfirm: "Supprimer cette classe?", resetConfirm: "R√©initialiser tous les √©l√®ves?",
                modalClass: "Nouvelle Classe", modalHelp: "Coller les noms (un par ligne):",
                cancel: "Annuler", save: "Enregistrer", config: "Param√®tres",
                configHelp: "Champ vide = sauter l'√©tape", empty: "Cr√©ez une classe pour commencer",
                defaultSteps: ["Avertissement", "Retenue", "Rapport", "Retrait", "EXCLUSION"]
            },
            de: {
                title: "Eskalationsleiter", newClass: "Klasse +", reset: "ZUR√úCKSETZEN",
                delConfirm: "Klasse l√∂schen?", resetConfirm: "Alle Sch√ºler terugsetzen?",
                modalClass: "Neue Klasse erstellen", modalHelp: "Namen einf√ºgen (einer pro Zeile):",
                cancel: "Abbrechen", save: "Speichern", config: "Einstellungen",
                configHelp: "Leeres Feld = Schritt √ºberspringen", empty: "Erstellen Sie eine Klasse",
                defaultSteps: ["Warnung", "Nachsitzen", "Bericht", "R√ºckschritt", "RAUSWURF"]
            }
        };

        let currentLang = localStorage.getItem('escalatie_lang') || 'nl';
        let classes = JSON.parse(localStorage.getItem('escalatie_classes')) || {};
        let currentClassName = localStorage.getItem('escalatie_current_class') || "";
        let steps = JSON.parse(localStorage.getItem('escalatie_steps')) || translations[currentLang].defaultSteps;

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('escalatie_lang', lang);
            
            document.getElementById('main-title').textContent = translations[lang].title;
            document.getElementById('btn-new-class').textContent = translations[lang].newClass;
            document.getElementById('btn-reset').textContent = translations[lang].reset;
            document.getElementById('modal-class-title').textContent = translations[lang].modalClass;
            document.getElementById('modal-class-help').textContent = translations[lang].modalHelp;
            document.getElementById('modal-config-title').textContent = translations[lang].config;
            document.getElementById('modal-config-help').textContent = translations[lang].configHelp;
            document.getElementById('btn-cancel-1').textContent = translations[lang].cancel;
            document.getElementById('btn-cancel-2').textContent = translations[lang].cancel;
            document.getElementById('btn-save-1').textContent = translations[lang].save;
            document.getElementById('btn-save-2').textContent = translations[lang].save;

            document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
            document.getElementById('flag-' + lang).classList.add('active');

            const wasDefault = Object.values(translations).some(t => JSON.stringify(t.defaultSteps) === JSON.stringify(steps));
            if(wasDefault) {
                steps = translations[lang].defaultSteps;
                localStorage.setItem('escalatie_steps', JSON.stringify(steps));
            }

            init();
        }

        function init() {
            renderLegend();
            updateSelector();
            if (currentClassName && classes[currentClassName]) {
                createGrid(classes[currentClassName]);
            } else {
                document.getElementById('grid').innerHTML = `<div style="color:#555; grid-column:1/-1; place-self:center">${translations[currentLang].empty}</div>`;
            }
        }

        function renderLegend() {
            const legend = document.getElementById('legendDisplay');
            legend.innerHTML = steps.map((step, i) => step.trim() !== "" ? `
                <div class="legend-item"><span class="dot" style="background: var(--color-${i+1})"></span> ${step}</div>
            ` : '').join('');
        }

        function openModal(id) {
            if(id === 'configModal') {
                const container = document.getElementById('configSteps');
                container.innerHTML = steps.map((step, i) => `
                    <div class="config-row">
                        <span class="config-dot" style="background: var(--color-${i+1})"></span>
                        <input type="text" class="config-input" value="${step}" data-index="${i}">
                    </div>
                `).join('');
            }
            document.getElementById(id).style.display = 'flex';
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        function saveConfig() {
            steps = Array.from(document.querySelectorAll('.config-input')).map(i => i.value);
            localStorage.setItem('escalatie_steps', JSON.stringify(steps));
            renderLegend(); closeModal('configModal');
            if(currentClassName) createGrid(classes[currentClassName]);
        }

        function saveNewClass() {
            const name = document.getElementById('newClassName').value.trim();
            const listText = document.getElementById('newStudentList').value;
            if (!name || !listText.trim()) return;
            classes[name] = listText.split(/\r?\n|,/).map(s => s.trim()).filter(s => s !== "");
            currentClassName = name;
            saveData(); updateSelector(); createGrid(classes[name]); closeModal('classModal');
        }

        function updateSelector() {
            const sel = document.getElementById('classSelector');
            sel.innerHTML = '';
            const keys = Object.keys(classes);
            sel.style.display = keys.length > 0 ? 'block' : 'none';
            keys.forEach(k => {
                const opt = document.createElement('option');
                opt.value = k; opt.textContent = k;
                if(k === currentClassName) opt.selected = true;
                sel.appendChild(opt);
            });
        }

        function switchClass() {
            currentClassName = document.getElementById('classSelector').value;
            localStorage.setItem('escalatie_current_class', currentClassName);
            createGrid(classes[currentClassName]);
        }

        function createGrid(studentArray) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            [...studentArray].sort().forEach(name => {
                const tile = document.createElement('div');
                tile.className = 'student-tile';
                tile.innerHTML = `<span class="student-name">${name}</span><span class="consequence"></span>`;
                tile.dataset.status = 0;
                tile.onclick = () => {
                    const activeSteps = steps.map((text, i) => ({ text, idx: i + 1 })).filter(s => s.text.trim() !== "");
                    let cur = parseInt(tile.dataset.status);
                    let next = cur === 0 ? activeSteps[0] : activeSteps[activeSteps.findIndex(s => s.idx === cur) + 1];
                    if (next) {
                        tile.dataset.status = next.idx;
                        tile.className = 'student-tile status-' + next.idx;
                        tile.querySelector('.consequence').innerText = next.text;
                    } else {
                        tile.dataset.status = 0;
                        tile.className = 'student-tile';
                        tile.querySelector('.consequence').innerText = "";
                    }
                };
                grid.appendChild(tile);
            });
        }

        function deleteCurrentClass() {
            if (currentClassName && confirm(translations[currentLang].delConfirm)) {
                delete classes[currentClassName];
                currentClassName = Object.keys(classes)[0] || "";
                saveData(); init();
            }
        }

        function resetAll() {
            if(confirm(translations[currentLang].resetConfirm)) {
                if(currentClassName) createGrid(classes[currentClassName]);
            }
        }

        function saveData() {
            localStorage.setItem('escalatie_classes', JSON.stringify(classes));
            localStorage.setItem('escalatie_current_class', currentClassName);
        }

        setLanguage(currentLang);
    </script>
</body>
</html>
